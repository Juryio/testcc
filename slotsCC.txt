-- ... existing code ...
local mon = peripheral.find("monitor")
local speaker = peripheral.find("speaker")
local chest = peripheral.find("minecraft:chest") or peripheral.find("chest") or peripheral.find("barrel")

if not mon then error("No Monitor attached! Please connect a Monitor.") end
mon.setTextScale(0.5) -- Adjust text scale to fit 51x26 if needed. 0.5 usually gives good resolution.
local mW, mH = mon.getSize()

-- --- CONFIGURATION --- --
local ASSET_FILE = "symbols.nfp"
local BET_COST = 10 -- Credits per spin
local CREDIT_ITEM = "minecraft:emerald"
local CREDITS_PER_ITEM = 10

-- Reel Positions (x coords) and Window (y coords)
-- INCREASED SIZE: 10 wide, 8 high
local SYMBOL_H = 8    -- Height of one symbol in pixels (Increased from 6)
local SYMBOL_W = 10   -- Width of one symbol (Increased from 8)
-- Adjusted reel positions for wider symbols (Spacing of 2 pixels)
local REEL_X = {3, 15, 27, 39, 51} 

local VISIBLE_ROWS = 3
local WIN_HEIGHT = VISIBLE_ROWS * SYMBOL_H -- 24 pixels (Total window height)
local WIN_Y_START = math.floor((mH - WIN_HEIGHT) / 2) -- Centered vertically
-- Ensure we don't overlap the header (row 1-2) if screen is tight
if WIN_Y_START < 3 then WIN_Y_START = 3 end

-- Payline Offsets (Relative to center row: 0)
-- 0 = Middle, -1 = Top, 1 = Bottom
-- ... existing code ...
local function loadAssets()
    if not fs.exists(ASSET_FILE) then
        createDefaultAssets()
    end
    
    spriteSheet = paintutils.loadImage(ASSET_FILE)
    
    -- Validation: Ensure we have enough lines AND correct width
    local expectedHeight = (#SYMBOLS * SYMBOL_H) / 4
    local expectedWidth = SYMBOL_W * 4
    
    -- Check if file matches new dimensions
    local invalid = false
    if #spriteSheet < expectedHeight then invalid = true end
    if spriteSheet[1] and #spriteSheet[1] ~= expectedWidth then invalid = true end
    
    if invalid then
        state.msg = "RESIZING ART..."
        if fs.exists(ASSET_FILE) then fs.delete(ASSET_FILE) end
        createDefaultAssets()
        spriteSheet = paintutils.loadImage(ASSET_FILE)
    end
end

-- Call immediately
loadAssets()

-- --- SOUND HELPERS --- --
-- ... existing code ...
